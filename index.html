<html>
    <head>
        <title>Music Player</title>

        <!--include jquery-->
        <script type="text/javascript" src="jquery-3.6.0.js"></script>
        <script type="text/javascript" src="jquery-ui.js"></script>
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="jquery-ui.css"/>
    </head>
    <body>
        <div id="m_player">
            <!--the audio player-->
            <audio id="Music_Player"><source id="Music_Source"/></audio>
            <!--div for the actual music player-->
            <div id="player"></div>
            <button id="Loop" disabled>Loop</button>
            <button id="Mix" disabled>Mix</button>
            <div id="bar_holder">
            <br/>
            <div id="progress_bar_back"><div id="progress_bar"><div id="slider" class="ui-draggable"></div></div></div>
            <br/>
            </div>
            <hr/>
        </div>
        <div>
            <div id="menu">
                <button onclick="backPanel.ChangeCurrentState(BackPanelState.MyMusic);">My Music</button>
                <button onclick="backPanel.ChangeCurrentState(BackPanelState.Playlists);">Playlists</button>
                <button onclick="backPanel.ChangeCurrentState(BackPanelState.Upload);">Upload</button>
            </div>
            <!--Back Panel that can be changed with React-->
            <div id="back_panel"></div>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
            <br/>
        </div>
        
        <!--Script defining the music player and music source constants-->
        <script type="text/javascript">
            const MUSICPLAYER = $('#Music_Player'); 
            const MUSICSOURCE = $('#Music_Source');

            var dragging = false;
            var duration = -1;
            var currentTime = -1;
            var setCurrentTime = -1;

            function MusicPlayerUpdateTime() {
                if(setCurrentTime != -1)
                {
                    this.currentTime = setCurrentTime;
                    setCurrentTime = -1;
                }

                currentTime = this.currentTime;

                var progress = (this.currentTime/this.duration) * parseInt($("#progress_bar_back").css("width"));
                $("#progress_bar").css("width", progress);

                if(!dragging)
                    $("#slider").css("left", progress);
            }

            MUSICPLAYER.bind('timeupdate', MusicPlayerUpdateTime);
            MUSICPLAYER.bind("ended", function() {NextSong();});
            MUSICPLAYER.bind("play", function(){
                duration = this.duration;
            });
                
        </script>

        <!--Delete file function-->
        <script type="text/javascript">
            function confirmDelete(fileName, id)
            {
                if(confirm("Delete "+fileName + "?"))
                {
                    $.ajax({
                        type :"POST",
                        url: 'delete_song.php',
                        data : {'filename':fileName, 'id': id},
                        success: function(response) 
                        { 
                            alert(response); 
                            $("#"+id+"_div").remove();
                        }, 
                        error: function(response) 
                        { 
                            alert("Error deleting " + filename); 
                        } 
                    });
                }
            }
        </script>

        <!--makes the slider draggable-->
        <script type="text/javascript">$(function() {
            $("#slider").draggable( {
                axis: "x",
                containment: "#progress_bar_back",
                start : function()
                {
                    dragging = true;
                },
                stop: function()
                {
                    dragging = false;
                    setCurrentTime = (parseInt($("#slider").css("left"))/parseInt($("#progress_bar_back").css("width"))) * duration;
                }
            });
        });
        </script>

        <!--React Library Scripts-->
        <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
        
        <!--JSX library (Babel)-->
        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

        <!--My React script(s)-->
        <script src="back_panel.js"></script>
        <script src="music_player.js"></script>
    </body>
</html>